{
  "$id": "http://www.parcore.org/schema/preservation_action.json/#",
  "$schema": "http://json-schema.org/draft-06/schema#",
  "definitions": {
    "inputItem": {
      "additionalProperties": false,
      "description": "An input to a preservation action",
      "properties": {
        "description": {
          "type": "string"
        },
        "name": {
          "type": "string"
        },
        "type": {
          "anyOf": [
            {
              "properties": {
                "file": {
                  "$ref": "http://www.parcore.org/schema/types.json/#/definitions/parFile"
                }
              },
              "type": "object"
            },
            {
              "properties": {
                "parProperty": {
                  "$ref": "http://www.parcore.org/schema/par_property.json/#"
                }
              },
              "type": "object"
            }
          ]
        }
      },
      "required": [
        "name",
        "description",
        "type"
      ],
      "title": "Preservation Action Input",
      "type": "object"
    },
    "outputItem": {
      "additionalProperties": false,
      "description": "An output from a preservation action",
      "properties": {
        "description": {
          "type": "string"
        },
        "name": {
          "type": "string"
        },
        "type": {
          "anyOf": [
            {
              "properties": {
                "file": {
                  "$ref": "http://www.parcore.org/schema/types.json/#/definitions/parFile"
                }
              },
              "type": "object"
            },
            {
              "properties": {
                "parProperty": {
                  "$ref": "http://www.parcore.org/schema/par_property.json/#"
                }
              },
              "type": "object"
            },
            {
              "properties": {
                "raw": {
                  "type": "string"
                }
              },
              "type": "object"
            }
          ]
        }
      },
      "required": [
        "name",
        "description",
        "type"
      ],
      "title": "Preservation Action Output",
      "type": "object"
    }
  },
  "properties": {
    "description": {
      "type": "string"
    },
    "example": {
      "type": "string"
    },
    "id": {
      "$ref": "http://www.parcore.org/schema/types.json/#/definitions/parIdentifier"
    },
    "inputs": {
      "additionalItems": false,
      "items": {
        "$ref": "http://www.parcore.org/schema/preservation_action.json/#/definitions/inputItem"
      },
      "minItems": 1,
      "type": "array"
    },
    "localLastModifiedDate": {
      "format": "date-time",
      "type": "string"
    },
    "outputs": {
      "additionalItems": false,
      "items": {
        "$ref": "http://www.parcore.org/schema/preservation_action.json/#/definitions/outputItem"
      },
      "minItems": 1,
      "additionalItems": false
    },
    "constraints": {
      "type": "array",
      "items": {
         "type": "object",
          "properties": {
            "inputItemName": {
              "type": "string"
            }, 
            "allowedPropertiesAnyOf": {
              "type": "array",
               "items": {
                  "$ref": "http://www.parcore.org/schema/par_property.json/#"
                }
            },
            "allowedPropertiesAllOf": {
              "type": "array",
               "items": {
                  "$ref": "http://www.parcore.org/schema/par_property.json/#"
                }
            },
            "allowedFormats": {
              "type": "array",
               "items": {
                  "$ref": "http://www.parcore.org/schema/format.json/#"
                }
            }

        }        
      },
      "minItems": 1,
      "additionalItems": false
    },
    "tool": {
      "$ref": "http://www.parcore.org/schema/tool.json/#"
    },
    "type": {
      "$ref": "http://www.parcore.org/schema/preservation_action_type.json/#"
    }
  },
  "required": [
    "id",
    "description",
    "type",
    "inputs",
    "outputs",
    "tool"
  ],
  "title": "Preservation Action",
  "type": "object"
}
